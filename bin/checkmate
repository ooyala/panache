#!/usr/bin/env ruby

require "checkmate"

# TODO(caleb): multiple output options.

def usage
  <<-EOF
Usage:
  checkmate [-s styles_directory] code_path [code_path ...]

The styles_directory may also be specified with the CHECKMATE_STYLES environment variable.
  EOF
end

style_directory = nil
code_paths = []
ARGV.each_with_index do |option, index|
  next if ARGV[index - 1] == "-s"
  if option == "-s"
    style_directory = ARGV[index + 1]
    next
  end
  code_paths << option
end
style_directory ||= ENV["CHECKMATE_STYLES"]

if style_directory.nil? || code_paths.empty?
  puts usage
  exit 1
end

Checkmate.load_styles(style_directory)
results = {}
code_paths.each { |path| results.merge! Checkmate.check_path(path) }
Checkmate::Printer.new(results).print_results
